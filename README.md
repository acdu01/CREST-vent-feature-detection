
## 0: Setup
Follow these steps to set up your environment and get the necessary files.

### 0.1: Create Environment

First, create a Conda environment with Python version 3.6.13, and install all the required libraries. This version is required due to the use of TensorFlow 1.12. 

1. Create the environment
```bash
conda create --name crest-env python=3.6.13
```

2. Activate the environment
```bash
conda activate crest-env
```

### 0.2: Install Required Libraries

The libraries used are:
- flake8==5.0.4
- h5py==3.1.0
- matplotlib 
- numpy==1.19.5
- tqdm==4.64.1
- SuperPoint as implemented in rpautrat/SuperPoint
- tensorboard==1.12.2
- tensorflow==1.12.0
- tensorflow-estimator==1.14.0
- tensorflow-gpu==1.12.0
- scipy==1.5.4
- PyYAML==6.0.1
- opencv-contrib-python==3.4.2.16
- opencv-python==3.4.2.16
- jupyter==1.1.1
- pandas==1.1.5
- Pillow

All libraries can be installed by running the following script:

```bash
pip install -r requirements.txt
```

Because this keypoint detection system uses an older implementation of SuperPoint, it is important that all the versions are as listed. 

### 0.3: Clone Repo

Run the following script:
```bash
git clone https://github.com/acdu01/CREST-vent-feature-detection.git
```

## 1: Video Processing

Input videos will be processed and frames will be extracted and saved as .png files at 6 fps. 

### 1.1: Folder Structure

The files are organized as follows:
```
1_video_processing/
├── input_vid/  # Put your video files here
├── output_img/ # Output images will be saved here automatically
```
You do **not** need to manually create the `output_img` folder — it will be generated by the script.

### 1.2: Usage

1. Place video files in the `1_video_processing/input_vid/` directory.
2. Run the following Python script:
```bash
python 1_video_processing/video2img.py
```
3. Extracted .png frames will be saved into `1_video_processing/output_img/`.


###  Supported Formats:

- **Input video formats**:
  - `.mp4`
  - `.mov`
  - `.avi`
  - `.mkv`
  - `.flv`
  - `.webm`

- **Output image format**:
  - `.png`


## 2: Superpoint-Aided Keypoint Detection
This is an extension to [rpautrat](https://github.com/rpautrat/SuperPoint?tab=readme-ov-file)'s implementation of SuperPoint. It takes video files as input, extracts individual frames, and uses the SuperPoint network to detect and visualize keypoints on each frame.

For each processed video, the tool generates:

- Visualizations of the detected keypoints on each frame.
- Individual .csv files containing the XY coordinates for each keypoint.
- A summary .csv file detailing the processing results.

### 2.1: Folder Structure

The files are organized as follows:
```
2_sp_implementation/
├── output/                         # All outputs are saved automatically
│   ├── processing_summary.csv      
│   ├── csv/                        # Output .csv files with keypoint xy coordinates 
│   └── visualizations/             # Output images with keypoints highlighted
```
You do **not** need to manually create the `output` folder or any subfolders — it will be generated by the script.

### 2.2: Usage

1. Run the following Python script:
```bash
python 2_sp_implementation/detect_features.py
```
2. Extracted .csv and .jpg files will be saved in `2_sp_implementation/output/`
